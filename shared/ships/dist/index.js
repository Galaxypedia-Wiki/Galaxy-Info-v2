var ee=Object.create;var f=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var H=s=>f(s,"__esModule",{value:!0});var T=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),ie=(s,e)=>{H(s);for(var r in e)f(s,r,{get:e[r],enumerable:!0})},ne=(s,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of re(e))!ae.call(s,t)&&t!=="default"&&f(s,t,{get:()=>e[t],enumerable:!(r=te(e,t))||r.enumerable});return s},oe=s=>ne(H(f(s!=null?ee(se(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0})),s);var U=T((fe,W)=>{W.exports=function(e){e=e.toLowerCase();var r={for:function(t){var a=0,i={found:!0};t=t.toLowerCase();for(var c=t.length,d=0;d<c;d++){if(a=e.indexOf(t[d],a),a===-1)return{found:!1};d==0&&(i.start=a)}return i.end=a+1,i}};return r}});var j=T((ye,K)=>{K.exports=function(e,r){for(var t=e.length,a=Math.ceil(t*r)||1,i=[],c=t;c>=a;){for(var d=t-c,n=0;n<=d;n++){var o=e.substr(n,c);i.indexOf(o)===-1&&i.push(o)}c--}return i}});var Y=T((Se,q)=>{var le=U(),he=j();q.exports=function(e,r,t){if(typeof e!="string"||e==="")return r;t=t||{};var a=t.accessor||function(n){return n},i=t.precision===void 0?1:t.precision,c=[],d=he(e,i);return r.forEach(function(n){var o=a(n);d.find(function(N){var m=le(o).for(N);return m.found&&c.push({gram:N,length:m.end-m.start,start:m.start,searchableItem:o,item:n}),m.found})}),c.sort(function(n,o){return n.gram.length!==o.gram.length?o.gram.length-n.gram.length:n.length!==o.length?n.length-o.length:n.start!==o.start?n.start-o.start:n.searchableItem>o.searchableItem?1:n.searchableItem<o.searchableItem?-1:0}).map(function(n){return n.item})}});ie(exports,{Alpha:()=>l,BASE_REQUIREMENTS:()=>ce,BUILD_MENU_CLASSES:()=>de,CLAMPS:()=>g,CLASSES:()=>ue,ClientShips:()=>X,ClientTurrets:()=>J,DAMAGE_TYPE_DISTRIBUTIONS:()=>h,Dps:()=>p,LOYALTY_REQUIREMENTS:()=>pe,NON_LIMITED_QUEST_SHIPS:()=>me,PERMITS:()=>S,RESISTANCE:()=>C,SPINALS:()=>y,SPINAL_RELOAD_EXPONENT:()=>A,ServerShips:()=>$,ServerTurrets:()=>V,Ship:()=>R,ShipFighters:()=>F,ShipNotFoundError:()=>b,ShipSpinal:()=>x,ShipSpinalGun:()=>P,ShipSpinals:()=>k,ShipTurrets:()=>G,ShipWeapons:()=>z,Ships:()=>v,ShipsNotDumpedError:()=>E,ShipsNotInitializedError:()=>D,TURRET_CLASS_DAMAGE_DISTRIBUTIONS:()=>I,TurretNotFoundError:()=>B,Turrets:()=>w,TurretsNotDumpedError:()=>_,TurretsNotInitializedError:()=>O,Weapon:()=>u});var Q=oe(Y());var ue=["Miner","Freighter","Frigate","Destroyer","Cruiser","Battlecruiser","Battleship","Dreadnought","Carrier","Super Capital","Fighter","Titan","Alien","Admin"],h={Laser:{shield:1,hull:.3,ideal:"shield"},Kinetic:{shield:.4,hull:1,ideal:"hull"},Plasma:{shield:1,hull:.7,ideal:"shield"},Missile:{shield:.7,hull:1,ideal:"hull"}},I={Mining:h.Laser,Laser:h.Laser,Railgun:h.Kinetic,Flak:h.Kinetic,Cannon:h.Kinetic,PDL:h.Laser},y={Phaser:{damageDistribution:h.Laser,Tiny:{damage:28,reload:.8,range:4500,velocity:5e3},Small:{damage:40,reload:1,range:4750,velocity:4500},Medium:{damage:72,reload:1.6,range:5e3,velocity:4e3},Large:{damage:120,reload:2.4,range:5250,velocity:3500},Huge:{damage:198,reload:3.6,range:5500,velocity:3e3}},Cannon:{damageDistribution:h.Kinetic,Tiny:{damage:40,reload:1.6,range:5500,velocity:3e3},Small:{damage:60,reload:2,range:5750,velocity:2800},Medium:{damage:112,reload:3.2,range:6e3,velocity:2600},Large:{damage:160,reload:4,range:6250,velocity:2400},Huge:{damage:270,reload:6,range:6500,velocity:2200}},Torpedo:{damageDistribution:h.Missile,Tiny:{damage:200,reload:5,range:8e3,velocity:700},Small:{damage:330,reload:6,range:9e3,velocity:600},Medium:{damage:490,reload:7,range:1e4,velocity:500},Large:{damage:680,reload:8,range:11e3,velocity:400},Huge:{damage:900,reload:9,range:12e3,velocity:300}}},A=1.1,S={"37":"SC Build","38":"Class A","39":"Class B","40":"Class C","41":"Class D","42":"Class E"},C={Fighter:0,Frigate:.2,Destroyer:.25,Cruiser:.3,Battlecruiser:.4,Battleship:.45,Dreadnought:.5,Carrier:.55,"Super Capital":.65,Titan:.7,Miner:.3,Freighter:.1,Alien:.3,Admin:.9},pe={Fighter:0,Frigate:0,Destroyer:0,Cruiser:0,Battlecruiser:.03,Battleship:.05,Dreadnought:.07,Carrier:.09,"Super Capital":.11,Titan:0,Miner:0,Freighter:0,Alien:0,Admin:0},ce={Fighter:1,Frigate:1,Destroyer:1,Cruiser:1,Battlecruiser:1,Battleship:1,Dreadnought:2,Carrier:2,"Super Capital":3,Titan:1,Miner:1,Freighter:1,Alien:1,Admin:1},de=["Miner","Freighter","Frigate","Destroyer","Cruiser","Battlecruiser","Battleship","Dreadnought","Carrier","Super Capital"],g={turnSpeed:[.1,.9],topSpeed:[45,380],acceleration:[5,50]},me=["Nightmare","Atheon","Zhen","Helios","Imperator","Osiris","Slipstream"];var u=class{},l=class{constructor(e,r,t){this.shield=e??0,this.hull=r??0,this.max=t??0}add(...e){for(let r of e)this.shield+=r.shield,this.hull+=r.hull,this.max+=r.max;return this}multiply(e){return this.shield*=e,this.hull*=e,this.max*=e,this}},p=class{constructor(e,r){this.shield=e??0,this.hull=r??0}add(...e){for(let r of e)this.shield+=r.shield,this.hull+=r.hull;return this}multiply(e){return this.shield*=e,this.hull*=e,this}get average(){return(this.shield+this.hull)/2}};var D=class extends Error{},E=class extends Error{},b=class extends Error{constructor(){super("Could not find a ship with that name.")}};function M(...s){console.log("[Ships]",...s)}function L(s,e,r){return Math.min(Math.max(s,e),r)}var v=class{constructor(e){this.ships={},this.turrets=e,this.initialized=!1}assertReady(){if(!this.initialized)throw new D("Ships instance has not been initialized; do `await <Ships>.init()` before using it.");if(Object.keys(this.ships).length===0)throw new E("Ships have not been exported from the game.")}async load(e){this.ships={},await this.loadShips(e,this.turrets,!0),await this.loadShips(e,this.turrets,!1),this.initialized=!0}async loadShips(e,r,t){for(let a of Object.values(e))try{if(!t&&a.class==="Fighter"||t&&a.class!=="Fighter")continue;let i=new R(this.ships,r,a);this.ships[i.name]=i}catch{}}find(e){if(this.assertReady(),this.ships.hasOwnProperty(e))return this.ships[e];let r=(0,Q.default)(e,Object.keys(this.ships))[0];if(!r)throw new b;return this.ships[r]}all(e){this.assertReady(),e||(e={});let r={};for(let t in this.ships)e.secret===!1&&(this.ships[t].secret||this.ships[t].test)||(r[t]=this.ships[t]);return r}get(e){if(this.assertReady(),!this.ships.hasOwnProperty(e))throw new b;return this.ships[e]}},R=class{constructor(e,r,t){this.serializedShip=t,this.name=t.name,this.test=t.test,this.class=t.class,this.resistance=C[this.class],this.description=t.description??"(no description)",this.eventId=t.eventId,this.permit=this.calculatePermit(),this.explosionSize=t.explosionSize,this.notForSale=t.notForSale,this.cargoHold=t.cargoHold,this.oreHold=t.oreHold,this.secret=t.secret,this.nonPlayer=t.nonPlayer||["Alien","Titan"].includes(this.class),this.canWarp=t.canWarp,this.stealth=t.stealth,t.customDrift&&(this.customDrift=t.customDrift,this.vip=t.vip),this.health=t.health,this.speed={top:t.topSpeed,acceleration:t.acceleration,turn:t.turnSpeed},this.weapons=new z(r,t.weapons),this.fighters=new F(e,t.fighters),this.extraMaterials=t.extraMaterials,this.speed.turn=L(this.speed.turn,...g.turnSpeed),this.secret||(this.speed.top=L(this.speed.top,...g.topSpeed),this.speed.acceleration=L(this.speed.acceleration,...g.acceleration))}calculatePermit(){if(!this.eventId||!this.serializedShip.permitOverride)return null;let e=this.serializedShip.permitOverride.toString();if(!(e in S))throw new Error(`Unknown permit override: ${e}`);return S[e]}},z=class extends u{constructor(e,r){super();this.turrets=new G(e,r.turrets),this.spinals=new k(r.spinals)}alpha(e,r=0){let t=this.turrets.alpha(e,r),a=this.spinals.alpha(e);return t.add(a)}dps(e,r=0){let t=this.turrets.dps(e,r),a=this.spinals.dps(e);return t.add(a)}},G=class extends u{constructor(e,r){super();this.turrets=new Map;for(let t of r){let a=e.get(t);this.incrementTurret(a)}}incrementTurret(e){let r=this.turrets.get(e)??0;this.turrets.set(e,r+1)}alpha(e,r=0){let t=new l;for(let[a,i]of this.turrets)t.add(a.alpha(e).multiply(i).multiply(1+r));return t}dps(e,r=0){let t=new p;for(let[a,i]of this.turrets)t.add(a.dps(e).multiply(i).multiply(1+r));return t}},k=class extends u{constructor(e){super();this.spinals=[],e.f&&(this.f=new x(e.f),this.spinals.push(this.f)),e.g&&(this.g=new x(e.g),this.spinals.push(this.g))}alpha(e){return new l().add(...this.spinals.map(r=>r.alpha(e)))}dps(e){return new p().add(...this.spinals.map(r=>r.dps(e)))}},x=class extends u{constructor(e){super();this.range=y[e.weaponType][e.weaponSize].range,this.guns=[];for(let t of e.guns)this.guns.push(new P(e,t));this.weaponSize=e.weaponSize,this.weaponType=e.weaponType,this.barrels=0;let r=this.guns[0];for(let t of this.guns)this.barrels+=t.barrels,t.barrels>r.barrels&&(r=t);typeof e.reloadOverride!="undefined"?this.reload=Math.max(.01,e.interval*(r.barrels-1)+e.reloadOverride):this.reload=r.reload}alpha(e){return e&&e>this.range?new l:new l().add(...this.guns.map(r=>r.alpha()))}dps(e){let r=this.alpha(e);return new p(r.shield/this.reload,r.hull/this.reload)}},P=class extends u{constructor(e,r){super();let t=y[e.weaponType],a=t[e.weaponSize];this._alpha=new l(r.barrels*a.damage*t.damageDistribution.shield,r.barrels*a.damage*t.damageDistribution.hull,r.barrels*a.damage*t.damageDistribution[t.damageDistribution.ideal]),this.interval=e.interval,this.reload=this.interval*(r.barrels-1)+a.reload*Math.pow(A,r.barrels-1),this.barrels=r.barrels}alpha(){return new l().add(this._alpha)}dps(){return new p(this._alpha.shield/this.reload,this._alpha.hull/this.reload)}},F=class extends u{constructor(e,r){super();this.hasFighters=!1,this.fighters=new Map;for(let t of r)try{let a=e[t];if(!a)continue;this.incrementFighter(a),this.hasFighters=!0}catch(a){M(a)}}incrementFighter(e){let r=this.fighters.get(e)??0;this.fighters.set(e,r+1)}alpha(e,r=0){let t=new l;for(let[a,i]of this.fighters)t.add(a.weapons.alpha(e,r).multiply(i));return t}dps(e,r=0){let t=new p;for(let[a,i]of this.fighters)t.add(a.weapons.dps(e,r).multiply(i));return t}},X=class extends v{constructor(e){super(e)}async init(e){await super.load(e)}},$=class extends v{constructor(e){super(e.turrets);this.GalaxyInfo=e}async init(){try{let e=await this.GalaxyInfo.prisma.keyValue.findUnique({where:{key:this.GalaxyInfo.config.db.kvKeys.serializedShips},rejectOnNotFound:!0});await super.load(e.value)}catch(e){M("Ships database reset.",e)}M("Initialized")}async save(e){await this.GalaxyInfo.prisma.keyValue.upsert({create:{key:this.GalaxyInfo.config.db.kvKeys.serializedShips,value:e},update:{value:e},where:{key:this.GalaxyInfo.config.db.kvKeys.serializedShips}}),await super.load(e)}};var O=class extends Error{},_=class extends Error{},B=class extends Error{},w=class{constructor(){this.turrets={},this.initialized=!1}assertReady(){if(!this.initialized)throw new O("Turrets instance has not been initialized; do `await <Turrets>.init()` before using it.");if(Object.keys(this.turrets).length===0)throw new _("Turrets have not been exported from the game.")}async load(e){for(let r of Object.values(e)){let t=new Z(r);this.turrets[t.name]=t}this.initialized=!0}get(e){if(this.assertReady(),!this.turrets.hasOwnProperty(e))throw new B(`Could not find turret called ${e}.`);return this.turrets[e]}all(){return this.assertReady(),this.turrets}},Z=class extends u{constructor(e){super();let r=e.Group==="Alien"?h.Plasma:I[e.Class];this._alpha=new l(e.Damage*r.shield,e.Damage*r.hull,e.Damage*r[r.ideal]),this.name=e.Name,this.range=e.Range,this.reload=e.Reload,this.group=e.Group,this.size=e.TurretSize,this.turretClass=e.Class,this.baseAccuracy=e.BaseAccuracy,this.trackingAccuracy=e.SpeedDenominator,this.test=["Test","Modelers"].includes(this.group),this.affectedByLoyalty=!["Mining"].includes(e.Class)}alpha(e,r=0){return this.affectedByLoyalty||(r=0),e&&e>this.range?new l:new l().add(this._alpha).multiply(1+r)}dps(e,r=0){let t=this.alpha(e,r);return new p(t.shield/this.reload,t.hull/this.reload)}accuracyDeviation(e){return this.size==="Large"&&e>80&&(e*=1+(e-80)*.003),this.size==="Medium"&&e>120&&(e*=1+(e-120)*.003),this.size==="Small"&&e>170&&(e*=1+(e-170)*.003),this.baseAccuracy+e/this.trackingAccuracy}},J=class extends w{constructor(){super()}async init(e){await super.load(e)}},V=class extends w{constructor(e){super();this.GalaxyInfo=e}async init(){try{let e=await this.GalaxyInfo.prisma.keyValue.findUnique({where:{key:this.GalaxyInfo.config.db.kvKeys.serializedTurrets},rejectOnNotFound:!0});await this.load(e.value)}catch{console.log("Turrets database reset.")}}async save(e){await this.GalaxyInfo.prisma.keyValue.upsert({create:{key:this.GalaxyInfo.config.db.kvKeys.serializedTurrets,value:e},update:{value:e},where:{key:this.GalaxyInfo.config.db.kvKeys.serializedTurrets}}),await this.load(e)}};
